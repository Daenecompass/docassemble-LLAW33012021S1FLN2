modules:
  - .progressivedisclosure
  - .sanitise
---
features:
  css: progressivedisclosure.css
---
# mandatory: True
# code: |
#   try:
#     from html import escape  # python 3.x
#   except ImportError:
#     from cgi import escape  # python 2.x
#   
#   def sanitise_nonword_match(match):
#     return escape(match.group(0)) # group 0 is the full matched text
# 
#   def sanitiseeee(text):
#     #text = r"**asdf**<b>hdfd</b><b>ut#\r#urir</b>bbbbbb_bb<br>aaaa\aaa\\aaa\\\aaa\\\\aaa\\\\\aaa([\\\*\{\}\[\]\(\)\|`_<>#\+\.!-])"
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     # escape backslashes specially first. I don't know why this is necessary
#     text = re.sub(r"\\", r"\\\\", text)
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     # escape certain markdown syntax (leave _, < and > alone)
#     text = re.sub(r"([\\\*\{\}\[\]\(\)\|`#\+\.!-])", r"\\\1", text)
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     # escape all html-syntax using html escape sequences
#     # text = re.sub("\W", sanitise_nonword_match, text)
#     text = escape(text)
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     # for some reason escaping underscores as \_ as you normally would
#     # in markdown duplicates them. Instead, escape them with an html
#     # escape sequence: &#95;
#     text = re.sub(r"_", r"&#95;", text)
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     # replace newlines with <br> tags, as these work properly in markdown tables
#     text = re.sub(r"(\r\n|\r|\n)", "<br>", text)
#     log(re.sub("(\r\n|\r|\n)", "NEWLINE", text), 'console')
#     
#     return text
---
template: incident_info
subject: |
  Further incident information
content: |
  Questions| Answers
  ------------------------|----------
  Transport type          |${other_details if (transport_type == "Other") else transport_type}
  Refusal date            |${FLNdate}
  Refusal time            |${FLNrefusal_time}
  Refusal postcode        |${FLNrefusal_postcode}
  Did refuser state why?  |${FLNrefusal_reason}
  Refusal reason          |${sanitise(driver_statement)}
  Was animal ID requested?|${refuser_asked_animal_id}
  Was animal ID shown?    |${user_show_id}
  Is evidence attached?   |${attach_evidence}
---
question: |
  Review your details.
subquestion: |
  Please check that these personal details are correct:
  
  Questions|Answers
  -----------------------------|----------
  Name of person reporting     |${FLNreporter_firstname} ${FLNreporter_lastname}
  Refused person's name        |${FLNrefused_firstname} ${FLNrefused_lastname}
  Refused person's e-mail      |${user_email}
  Refused person's phone number|${FLNphone}
  
  And optionally that the rest of the incident information is correct:
  
  ${ prog_disclose(incident_info) }
continue button field: FLNreview_complete